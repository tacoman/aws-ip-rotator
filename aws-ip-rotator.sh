#!/usr/bin/env bash

case $1 in
    'start' )
	apt-get install -y awscli
	SCHEDULE='*/10 * * * *' # every ten minutes
	(crontab -l 2> /dev/null; echo "$SCHEDULE $(pwd)/$(basename $0)") | crontab - ;;
    'stop' )
	crontab -l | grep -v $(basename $0) | crontab - ;;
    *)
	INSTANCE=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
	OLD_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)
	NEW_IP=$(aws ec2 allocate-address --query PublicIp | tr -d '"')
	echo ''
	echo "Old IP: $OLD_IP"
	echo "New IP: $NEW_IP"
	echo ''
	echo 'Associating new IP...'
	aws ec2 associate-address --instance-id $INSTANCE --public-ip $NEW_IP
	echo 'Releasing old IP...'
	aws ec2 release-address --public-ip $OLD_IP
	echo 'Voting for bracket 1...'
	curl 'https://chicagonisa.com/monikermadness/' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Content-Type: multipart/form-data; boundary=---------------------------212787996622332115561492786340' -H 'Origin: https://chicagonisa.com' -H 'Connection: keep-alive' -H 'Referer: https://chicagonisa.com/monikermadness/' -H 'Cookie: asp_transient_id=e07b3572cee3a5145a71a1e726b87e12' -H 'Upgrade-Insecure-Requests: 1' --data-binary $'-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="frm_action"\r\n\r\ncreate\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="form_id"\r\n\r\n6\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="frm_hide_fields_6"\r\n\r\n\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="form_key"\r\n\r\nchicagomonikermadness-play-inroundd4e665df1e\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[0]"\r\n\r\n\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="frm_submit_entry_6"\r\n\r\n94ffedc9ba\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="_wp_http_referer"\r\n\r\n/monikermadness/\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[39]"\r\n\r\nChicago Chiotes\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[40]"\r\n\r\nChicago Onionmen\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[41]"\r\n\r\nChicago Municipal\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[42]"\r\n\r\nChicago Untouchables\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[43]"\r\n\r\nChicago Bricklayers\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[44]"\r\n\r\nChicago Towers\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[45]"\r\n\r\nAtomic Chicago\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_meta[46]"\r\n\r\nChicago O\'s\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="item_key"\r\n\r\n\r\n-----------------------------212787996622332115561492786340\r\nContent-Disposition: form-data; name="frm_verify"\r\n\r\n\r\n-----------------------------212787996622332115561492786340--\r\n'
	echo 'Voting for bracket 2...'
	curl 'https://chicagonisa.com/monikermadness/' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Content-Type: multipart/form-data; boundary=---------------------------85458272520521354382558868748' -H 'Origin: https://chicagonisa.com' -H 'Connection: keep-alive' -H 'Referer: https://chicagonisa.com/monikermadness/' -H 'Cookie: asp_transient_id=e07b3572cee3a5145a71a1e726b87e12' -H 'Upgrade-Insecure-Requests: 1' --data-binary $'-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="frm_action"\r\n\r\ncreate\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="form_id"\r\n\r\n7\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="frm_hide_fields_7"\r\n\r\n\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="form_key"\r\n\r\nchicagomonikermadness-play-inroundd4e665df1e16cd0883f5\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[0]"\r\n\r\n\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="frm_submit_entry_7"\r\n\r\n94ffedc9ba\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="_wp_http_referer"\r\n\r\n/monikermadness/\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[47]"\r\n\r\nChicago Raccoons\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[48]"\r\n\r\nChicago 2020\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[49]"\r\n\r\nChicago Haymarket\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[50]"\r\n\r\nChicago Athletic Club\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[51]"\r\n\r\nChicago Bronze\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[52]"\r\n\r\nChicago Guardians\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[53]"\r\n\r\nGarden City Chicago\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_meta[54]"\r\n\r\nChicago Rhythm\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="item_key"\r\n\r\n\r\n-----------------------------85458272520521354382558868748\r\nContent-Disposition: form-data; name="frm_verify"\r\n\r\n\r\n-----------------------------85458272520521354382558868748--\r\n'
esac
